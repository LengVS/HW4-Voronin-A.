---
title: Д/З №4 Воронин А.В.

Задние 1. 
---
```{r}
install.packages("ggplot2")
install.packages("tidyverse")
install.packages("car")

library(ggplot2)
library(tidyverse)
library(car)
```
```{r}
# Задаем seed для воспроизводимости результатов
set.seed(123)
```
```{r}
# Задаем размер выборки
sample_size <- 30

```{r}
# Задаем значение среднего артериального давления до приема нового препарата
pre_treatment_mean <- 130

# Задаем значение среднего артериального давления после приема нового препарата
post_treatment_mean <- 120
```
```{r}
# Формулируем нулевую и альтернативную гипотезы
null_hypothesis <- "Среднее артериальное давление не изменилось после приема нового препарата"
alternative_hypothesis <- "Среднее артериальное давление изменилось после приема нового препарата"
```
```{r}
# Задаем уровень значимости
alpha <- 0.05

# Создание данных
before <- rnorm(sample_size, pre_treatment_mean, 5)
after <- rnorm(sample_size, post_treatment_mean, 5)

# Выбираем статистический тест (в данном случае используем t-test, так как имеем две выборки и предполагаем, что выборки взяты из нормальных распределений)
# Проведение t-теста для парных выборок
t_test_result <- t.test(before, after, paired = TRUE)

# Вывод результатов
cat("Уровень значимости:", t_test_result$p.value, "\n")

if (t_test_result$p.value < alpha) {
  cat("Результат является статистически значимым на уровне", alpha, "\n")
} else {
  cat("Результат не является статистически значимым на уровне", alpha, "\n")
}
```
```{r}
# Проводим тест Шапиро Уилка для определения нормальности распределения данных
shapiro.test(before)
shapiro.test(after)
```
```{r}
# Оба набора данных не имеют статистически значимых различий от нормального распределения на уровне значимости 0.05. Таким образом, можно предположить, что оба набора данных распределены нормально.
```


```{r}
## Задание 2

# Генерация данных
set.seed(123)

# Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2
# Задаем параметры
smoking <- 0.8
non_smoking <- 0.2

# Задаем выборку размером 100
sample_size1 <- 100

# Задаем выборку размером 30
sample_size2 <- 30

# Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.
smokers1 <- rep(1, sample_size1 / 2)
non_smokers1 <- rep(0, sample_size1 / 2)

smokers2 <- rep(1, sample_size2 / 2)
non_smokers2 <- rep(0, sample_size2 / 2)
```
```{r}
#Сформулируйте нулевую и альтернативную гипотезы.
   - Нулевая гипотеза (H0): Вероятность заболеть раком легких у курящих и некурящих людей одинакова.
   - Альтернативная гипотеза (H1): Вероятность заболеть раком легких у курящих людей выше, чем у некурящих.
# Уровень значимости
alpha <- 0.05

```{r}
# Для проверки гипотезы используем Z-тест, поскольку:
- выборка является достаточно большой (sample_size > 30)
- предполагается что исходные данные имеют нормальное распределение или выборка достаточно большая, чтобы центральная предельная теорема была применима.
- нас интересует разность двух средних или отношение двух средних.
- предполагается что измеряемая величина является непрерывной.
```

```{r}
# Проводим z-тест для обеих выборок
result1 <- prop.test(x = c(sum(smokers1), sum(non_smokers1)), n = c(length(smokers1), length(non_smokers1)), correct = FALSE)
result2 <- prop.test(x = c(sum(smokers2), sum(non_smokers2)), n = c(length(smokers2), length(non_smokers2)), correct = FALSE)

result1
result2
```

```{r}
# 2-sample test for equality of proportions without continuity correction

data:  c(sum(smokers1), sum(non_smokers1)) out of c(length(smokers1), length(non_smokers1))
X-squared = 100, df = 1, p-value < 2.2e-16
alternative hypothesis: two.sided
95 percent confidence interval:
 1 1
sample estimates:
prop 1 prop 2 
     1      0 


	2-sample test for equality of proportions without continuity correction

data:  c(sum(smokers2), sum(non_smokers2)) out of c(length(smokers2), length(non_smokers2))
X-squared = 30, df = 1, p-value = 4.32e-08
alternative hypothesis: two.sided
95 percent confidence interval:
 1 1
sample estimates:
prop 1 prop 2 
     1      0 
     
# Вывод: Наблюдаемые значения статистики превышают критические, статистическая значимость между двумя группами подтверждена, отклоняем нулевую гипотезу.
# Связь между курением и раком легких подтверждается.
```


```{r}
## Задание 3

{r}
# Задаем seed для воспроизводимости результатов
set.seed(123)

# Задаем размеры выборок
sample_size1 <- 30
sample_size2 <- 30

# Генерируем данные для двух групп
group1 <- rnorm(sample_size1, mean = 130, sd = 10)
group2 <- rnorm(sample_size2, mean = 120, sd = 10)

#Так как мы предполагаем, что выборки независимы и имеют одинаковое распределение, предпочтительно использовать двухвыборочный t-тест. 
#Проводим двухвыборочный t-тест
t.test_result <- t.test(group1, group2, alternative = "two.sided", var.equal = TRUE)

# Получаем значение t и p-value
t_value <- t.test_result$statistic
p_value <- t.test_result$p.value

# Определяем критическое значение t с заданным уровнем значимости
alpha <- 0.05
degrees_of_freedom <- sample_size1 + sample_size2 - 2
critical_value_t <- qt(1 - alpha / 2, df = degrees_of_freedom)

# Проверяем статистическую значимость
if (abs(t_value) > critical_value_t) {
  print("Отвергаем нулевую гипотезу. Медицинские симптомы раздраженного кишечника у двух групп различаются.")
} else {
  print("Нет достаточных оснований для отклонения нулевой гипотезы. Медицинские симптомы раздраженного кишечника у двух групп не отличаются.")
}
#"Отвергаем нулевую гипотезу. Медицинские симптомы раздраженного кишечника у двух групп различаются."
# Новый метод лечения статистически значимо снижает уровень боли.
```


```{r}
## Задание 4

# Генерируем датасет
set.seed(123)
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

```{r}
#Постройте на одном графике три "ящика с усами" для наглядности:
ggplot(tumor, aes(x = therapy, y = value)) +
  geom_boxplot() +
  labs(x = "Лечение", y = "Размер опухоли") +
  theme_minimal()
```

```{r}
# Проведим дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах.
anova_result <- aov(value ~ therapy, data = tumor)
summary(anova_result)
# Мы не можем отклонить нулевую гипотезу о равенстве средних размеров опухолей между группами терапии A, B и плацебо.
# Значимого влияния противоопухолевых препаратов A и B по сравнению с плацебо на размер опухоли нет.
```

```{r}
# Проводим попарные сравнения, используя критерий Тьюки С помощью функции TukeyHSD():
tukey_result <- TukeyHSD(anova_result)
tukey_result
# Общий вывод из проведенного попарного анализа заключается в том, что различия в эффективности между препаратами A и B, а также между каждым из них и плацебо, статистически не значимы на стандартном уровне значимости 0.05. Однако, стоит обратить внимание на почти достижение порога значимости в сравнении препаратов B и A, что может указывать на тенденцию к различиям между ними.